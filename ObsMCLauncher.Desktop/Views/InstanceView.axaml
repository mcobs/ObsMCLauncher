<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:ObsMCLauncher.Desktop.ViewModels"
             x:Class="ObsMCLauncher.Desktop.Views.InstanceView"
             x:DataType="vm:InstanceViewModel">

  <Border Background="{DynamicResource BackgroundBrush}" IsVisible="{Binding IsVisible}">
    <Grid RowDefinitions="Auto,*">
      <!-- 顶部导航栏 -->
      <Border Grid.Row="0"
              Background="{DynamicResource SurfaceBrush}"
              BorderBrush="{DynamicResource BorderBrush}"
              BorderThickness="0,0,0,1"
              Padding="24,12"
              Height="60">
        <Grid ColumnDefinitions="Auto,*,Auto">
          <Button Grid.Column="0"
                  Command="{Binding CloseCommand}"
                  Width="36" Height="36"
                  CornerRadius="18"
                  Background="Transparent">
            <Path Data="M20 11H7.83L13.42 5.41L12 4L4 12L12 20L13.41 18.59L7.83 13H20V11Z"
                  Width="18" Height="18"
                  Stretch="Uniform"
                  Fill="{DynamicResource TextBrush}" />
          </Button>

          <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="16,0,0,0" Orientation="Horizontal" Spacing="12">
            <TextBlock Text="版本实例管理" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding VersionId}" FontSize="14" Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center"/>
          </StackPanel>
        </Grid>
      </Border>

      <!-- 内容区域 -->
      <ScrollViewer Grid.Row="1" Padding="24">
        <StackPanel Spacing="12" MaxWidth="900">
          
          <!-- 版本信息 -->
          <Border Background="{DynamicResource SurfaceElevatedBrush}" CornerRadius="8" Padding="16">
            <Grid ColumnDefinitions="*,*">
              <StackPanel Grid.Column="0" Spacing="8">
                <TextBlock Text="版本信息" FontSize="14" FontWeight="Bold" Margin="0,0,0,8"/>
                <Grid ColumnDefinitions="80,*">
                  <TextBlock Grid.Column="0" Text="实际版本：" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                  <TextBlock Grid.Column="1" Text="{Binding ActualVersion}" FontSize="12"/>
                </Grid>
                <Grid ColumnDefinitions="80,*">
                  <TextBlock Grid.Column="0" Text="版本类型：" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                  <TextBlock Grid.Column="1" Text="{Binding VersionType}" FontSize="12"/>
                </Grid>
                <Grid ColumnDefinitions="80,*">
                  <TextBlock Grid.Column="0" Text="上次游玩：" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                  <TextBlock Grid.Column="1" Text="{Binding LastPlayed}" FontSize="12"/>
                </Grid>
              </StackPanel>
              <StackPanel Grid.Column="1" Spacing="8">
                <TextBlock Text="版本设置" FontSize="14" FontWeight="Bold" Margin="0,0,0,8"/>
                <Grid ColumnDefinitions="80,*">
                  <TextBlock Grid.Column="0" Text="版本隔离：" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                  <ComboBox Grid.Column="1" SelectedIndex="{Binding IsolationMode}" FontSize="12" Height="28">
                    <ComboBoxItem Content="跟随全局设置"/>
                    <ComboBoxItem Content="启用版本隔离"/>
                    <ComboBoxItem Content="禁用版本隔离"/>
                  </ComboBox>
                </Grid>
                <Grid ColumnDefinitions="80,*">
                  <TextBlock Grid.Column="0" Text="存储路径：" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" VerticalAlignment="Center"/>
                  <Button Grid.Column="1" Command="{Binding OpenFolderCommand}"
                          Background="Transparent" Padding="0" HorizontalAlignment="Left" Height="20">
                    <TextBlock Text="{Binding StoragePath}" Foreground="{DynamicResource PrimaryBrush}" FontSize="12" TextDecorations="Underline" TextTrimming="CharacterEllipsis" MaxWidth="250"/>
                  </Button>
                </Grid>
              </StackPanel>
            </Grid>
          </Border>

          <!-- 存档和Mod管理并排 -->
          <Grid ColumnDefinitions="*,12,*">
            <!-- 存档管理 -->
            <Border Grid.Column="0" Background="{DynamicResource SurfaceElevatedBrush}" CornerRadius="8" Padding="16">
              <Grid RowDefinitions="Auto,Auto,*">
                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                  <TextBlock Grid.Column="0" Text="存档管理" FontSize="14" FontWeight="Bold"/>
                  <Button Grid.Column="1" Command="{Binding OpenSavesFolderCommand}"
                          Background="Transparent" Padding="8,4" Height="24">
                    <Path Data="M20 6H12L10 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V8C22 6.9 21.1 6 20 6M20 18H4V8H20V18Z"
                          Width="14" Height="14" Stretch="Uniform" Fill="{DynamicResource TextSecondaryBrush}"/>
                  </Button>
                </Grid>
                <TextBlock Grid.Row="1" Text="{Binding Worlds.Count, StringFormat='共 {0} 个存档'}" 
                           Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11" Margin="0,4,0,8"/>

                <ScrollViewer Grid.Row="2" MaxHeight="200">
                  <ItemsControl ItemsSource="{Binding Worlds}" IsVisible="{Binding HasWorlds}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="10" Margin="0,0,0,6">
                          <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="12" TextTrimming="CharacterEllipsis"/>
                        </Border>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </ScrollViewer>

                <TextBlock Grid.Row="2" Text="暂无存档" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"
                           IsVisible="{Binding !HasWorlds}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
              </Grid>
            </Border>

            <!-- Mod管理 -->
            <Border Grid.Column="2" Background="{DynamicResource SurfaceElevatedBrush}" CornerRadius="8" Padding="16">
              <Grid RowDefinitions="Auto,Auto,*">
                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                  <TextBlock Grid.Column="0" Text="Mod管理" FontSize="14" FontWeight="Bold"/>
                  <Button Grid.Column="1" Command="{Binding OpenModsFolderCommand}"
                          Background="Transparent" Padding="8,4" Height="24">
                    <Path Data="M20 6H12L10 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V8C22 6.9 21.1 6 20 6M20 18H4V8H20V18Z"
                          Width="14" Height="14" Stretch="Uniform" Fill="{DynamicResource TextSecondaryBrush}"/>
                  </Button>
                </Grid>
                <TextBlock Grid.Row="1" Text="{Binding Mods.Count, StringFormat='共 {0} 个Mod'}" 
                           Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11" Margin="0,4,0,8"/>

                <ScrollViewer Grid.Row="2" MaxHeight="200">
                  <ItemsControl ItemsSource="{Binding Mods}" IsVisible="{Binding HasMods}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="10" Margin="0,0,0,6">
                          <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="12" TextTrimming="CharacterEllipsis"/>
                        </Border>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </ScrollViewer>

                <TextBlock Grid.Row="2" Text="暂无Mod" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"
                           IsVisible="{Binding !HasMods}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
              </Grid>
            </Border>
          </Grid>

        </StackPanel>
      </ScrollViewer>

      <!-- 加载中遮罩 -->
      <Border Grid.Row="1" Background="{DynamicResource BackgroundBrush}" Opacity="0.8" IsVisible="{Binding IsLoading}">
        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
          <ProgressBar IsIndeterminate="True" Width="100"/>
          <TextBlock Text="加载中..." Margin="0,12,0,0" HorizontalAlignment="Center"/>
        </StackPanel>
      </Border>
    </Grid>
  </Border>

</UserControl>
