<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ObsMCLauncher.Desktop.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="600"
        x:Class="ObsMCLauncher.Desktop.Views.YggdrasilLoginWindow"
        x:DataType="vm:YggdrasilLoginViewModel"
        Title="å¤–ç½®ç™»å½•"
        Width="500" Height="600"
        WindowStartupLocation="CenterOwner"
        SystemDecorations="None"
        ExtendClientAreaToDecorationsHint="True"
        Background="Transparent"
        TransparencyLevelHint="AcrylicBlur">

  <Panel>
    <!-- èƒŒæ™¯é®ç½©æ¨¡æ‹Ÿ WPF é£Žæ ¼ -->
    <Border Background="{DynamicResource BackgroundBrush}" Opacity="0.95" CornerRadius="12" Margin="20">
      <Border.BoxShadow>
        <BoxShadows>0 10 30 0 #80000000</BoxShadows>
      </Border.BoxShadow>
    </Border>

    <Grid Margin="40" RowDefinitions="Auto,*,Auto">
      <!-- æ ‡é¢˜æ  -->
      <StackPanel Grid.Row="0" Margin="0,0,0,20">
        <TextBlock Text="å¤–ç½®ç™»å½•" FontSize="24" FontWeight="Bold" Foreground="{DynamicResource TextBrush}"/>
        <TextBlock Text="ä½¿ç”¨ Yggdrasil è®¤è¯æœåŠ¡å™¨ç™»å½•" FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,4,0,0"/>
      </StackPanel>

      <!-- å†…å®¹åŒº -->
      <Panel Grid.Row="1">
        <!-- ç™»å½•è§†å›¾ -->
        <ScrollViewer IsVisible="{Binding !ShowServerManagement}">
          <StackPanel Spacing="15">
            <TextBlock Text="è®¤è¯æœåŠ¡å™¨" FontSize="14" FontWeight="SemiBold"/>
            <ComboBox HorizontalAlignment="Stretch" 
                      ItemsSource="{Binding Servers}" 
                      SelectedItem="{Binding SelectedServer}">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="ðŸ›¡" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                  </StackPanel>
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>

            <Button Content="ç®¡ç†æœåŠ¡å™¨" Command="{Binding ToggleServerManagementCommand}" Classes="outline"/>

            <Border Background="{DynamicResource SurfaceElevatedBrush}" CornerRadius="8" Padding="20">
              <StackPanel Spacing="10">
                <TextBlock Text="è´¦å·ä¿¡æ¯" FontSize="14" FontWeight="SemiBold"/>
                
                <StackPanel Spacing="5">
                  <TextBlock Text="ç”¨æˆ·å/é‚®ç®±" FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}"/>
                  <TextBox Text="{Binding Username}" Watermark="è¯·è¾“å…¥ç”¨æˆ·åæˆ–é‚®ç®±"/>
                </StackPanel>

                <StackPanel Spacing="5">
                  <TextBlock Text="å¯†ç " FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}"/>
                  <TextBox Text="{Binding Password}" PasswordChar="*" Watermark="è¯·è¾“å…¥å¯†ç "/>
                </StackPanel>
              </StackPanel>
            </Border>

            <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="6" Padding="12">
              <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBlock Text="â„¹" Foreground="{DynamicResource PrimaryBrush}" VerticalAlignment="Top"/>
                <TextBlock Text="å¤–ç½®ç™»å½•éœ€è¦åœ¨ç¬¬ä¸‰æ–¹è®¤è¯æœåŠ¡å™¨æ³¨å†Œè´¦å·ã€‚æŽ¨èä½¿ç”¨ LittleSkin æœåŠ¡ã€‚" 
                           FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" TextWrapping="Wrap"/>
              </StackPanel>
            </Border>
          </StackPanel>
        </ScrollViewer>

        <!-- æœåŠ¡å™¨ç®¡ç†è§†å›¾ -->
        <ScrollViewer IsVisible="{Binding ShowServerManagement}">
          <StackPanel Spacing="15">
            <Button Content="â† è¿”å›žç™»å½•" Command="{Binding ToggleServerManagementCommand}" Classes="outline"/>
            <TextBlock Text="ç®¡ç†è®¤è¯æœåŠ¡å™¨" FontSize="20" FontWeight="Bold"/>
            
            <Border Background="{DynamicResource SurfaceElevatedBrush}" CornerRadius="8" Padding="15">
              <StackPanel Spacing="10">
                <TextBlock Text="æ·»åŠ æ–°æœåŠ¡å™¨" FontWeight="SemiBold"/>
                <TextBox Text="{Binding NewServerName}" Watermark="æœåŠ¡å™¨åç§°"/>
                <TextBox Text="{Binding NewServerUrl}" Watermark="æœåŠ¡å™¨åœ°å€ (å¦‚ littleskin.cn)"/>
                <Button Content="æ·»åŠ " Command="{Binding AddServerCommand}" HorizontalAlignment="Right" Classes="accent"/>
              </StackPanel>
            </Border>

            <ItemsControl ItemsSource="{Binding Servers}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border Background="{DynamicResource SurfaceElevatedBrush}" CornerRadius="8" Padding="12" Margin="0,0,0,8">
                    <Grid ColumnDefinitions="*,Auto">
                      <StackPanel>
                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding ApiUrl}" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}"/>
                      </StackPanel>
                      <Button Grid.Column="1" Content="åˆ é™¤" 
                              Command="{Binding $parent[Window].((vm:YggdrasilLoginViewModel)DataContext).DeleteServerCommand}" 
                              CommandParameter="{Binding}"
                              IsVisible="{Binding !IsBuiltIn}" Classes="danger"/>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </ScrollViewer>

        <!-- åŠ è½½/ç™»å½•ä¸­é®ç½© -->
        <Border Background="{DynamicResource BackgroundBrush}" Opacity="0.8" IsVisible="{Binding IsLoggingIn}" CornerRadius="8">
          <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="10">
            <ProgressBar IsIndeterminate="True" Width="100"/>
            <TextBlock Text="{Binding StatusMessage}" HorizontalAlignment="Center"/>
          </StackPanel>
        </Border>
      </Panel>

      <!-- åº•éƒ¨æŒ‰é’® -->
      <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="15" Margin="0,20,0,0">
        <Button Content="å–æ¶ˆ" Width="100" Click="Cancel_Click" Classes="outline"/>
        <Button Content="ç™»å½•" Width="100" Command="{Binding LoginCommand}" IsVisible="{Binding !ShowServerManagement}" Classes="accent"/>
      </StackPanel>
    </Grid>
  </Panel>
</Window>
