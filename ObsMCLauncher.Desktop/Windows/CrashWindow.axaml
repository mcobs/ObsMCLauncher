<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ObsMCLauncher.Desktop.ViewModels"
        x:Class="ObsMCLauncher.Desktop.Windows.CrashWindow"
        x:DataType="vm:CrashWindowViewModel"
        Title="程序崩溃了"
        Height="560" Width="860"
        MinHeight="420" MinWidth="640"
        WindowStartupLocation="CenterScreen"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="NoChrome"
        ExtendClientAreaTitleBarHeightHint="-1"
        Background="{DynamicResource BackgroundBrush}">

<Window.Styles>
    <!-- 修复：TextBox 悬停/聚焦时背景和边框不要变化 -->
    <Style Selector="TextBox">
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="BorderBrush" Value="Transparent"/>
      <Setter Property="BorderThickness" Value="0"/>
    </Style>
    <Style Selector="TextBox:pointerover">
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="BorderBrush" Value="Transparent"/>
      <Setter Property="BorderThickness" Value="0"/>
    </Style>
    <Style Selector="TextBox:focus">
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="BorderBrush" Value="Transparent"/>
      <Setter Property="BorderThickness" Value="0"/>
    </Style>
    <Style Selector="TextBox:focus-within">
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="BorderBrush" Value="Transparent"/>
      <Setter Property="BorderThickness" Value="0"/>
    </Style>
  </Window.Styles>

  <Grid RowDefinitions="40,*,Auto">
    <!-- 标题栏 -->
    <Border Grid.Row="0"
            Background="{DynamicResource SurfaceBrush}"
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="0,0,0,1"
            PointerPressed="TitleBar_PointerPressed">
      <Grid ColumnDefinitions="*,Auto">
        <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="15,0" VerticalAlignment="Center">
          <TextBlock Text="⚠" FontSize="18" Foreground="#DC3545" VerticalAlignment="Center"/>
          <TextBlock Text="程序发生严重错误" FontSize="13" FontWeight="SemiBold" Margin="10,0,0,0" VerticalAlignment="Center"/>
        </StackPanel>

        <Button Grid.Column="1" Command="{Binding CloseCommand}"
                Width="46" Height="40"
                Background="Transparent"
                HorizontalContentAlignment="Center"
                VerticalContentAlignment="Center">
          <TextBlock Text="✕" FontSize="14"/>
        </Button>
      </Grid>
    </Border>

    <!-- 内容区域 -->
    <Grid Grid.Row="1" Margin="20">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>

      <TextBlock Grid.Row="0"
                 Text="你可以将下方错误信息复制给开发者，以便快速定位问题。"
                 Foreground="{DynamicResource TextSecondaryBrush}"
                 TextWrapping="Wrap"/>

      <Border Grid.Row="1"
              Background="{DynamicResource SurfaceBrush}"
              BorderBrush="{DynamicResource BorderBrush}"
              BorderThickness="1"
              CornerRadius="10"
              Padding="12"
              Margin="0,14,0,0">
        <StackPanel Spacing="6">
          <TextBlock Text="错误摘要" FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}"/>
          <TextBlock Text="{Binding Summary}" FontSize="13" FontWeight="SemiBold" TextWrapping="Wrap"/>
        </StackPanel>
      </Border>

      <Border Grid.Row="2"
              Background="#151515"
              BorderBrush="{DynamicResource BorderBrush}"
              BorderThickness="1"
              CornerRadius="10"
              Padding="12"
              Margin="0,14,0,0">
        <Grid RowDefinitions="Auto,*">
          <TextBlock Grid.Row="0" Text="详细错误信息" FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,8"/>
          
          <TextBox Grid.Row="1"
                   Text="{Binding CrashReport}"
                   IsReadOnly="True"
                   Background="Transparent"
                   BorderThickness="0"
                   Foreground="#FFFFFF"
                   FontFamily="Consolas,Courier New"
                   FontSize="12"
                   TextWrapping="NoWrap"
                   AcceptsReturn="True"
                   ScrollViewer.VerticalScrollBarVisibility="Auto"
                   ScrollViewer.HorizontalScrollBarVisibility="Auto"/>
        </Grid>
      </Border>
    </Grid>

    <!-- 底部按钮栏 -->
    <Border Grid.Row="2"
            Background="{DynamicResource SurfaceBrush}"
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="0,1,0,0"
            Padding="15,12">
      <Grid ColumnDefinitions="*,Auto,Auto,Auto">
        <TextBlock Grid.Column="0"
                   Text="{Binding LogPathText}"
                   Foreground="{DynamicResource TextSecondaryBrush}"
                   VerticalAlignment="Center"
                   TextTrimming="CharacterEllipsis"/>

        <Button Grid.Column="1" Content="导出日志" Command="{Binding ExportCommand}"
                Classes="outline" Height="34" Padding="12,0" Margin="0,0,10,0"/>

        <Button Grid.Column="2" Content="复制错误信息" Command="{Binding CopyCommand}"
                Classes="outline" Height="34" Padding="12,0" Margin="0,0,10,0"/>

        <Button Grid.Column="3" Content="退出启动器" Command="{Binding ExitCommand}"
                Background="#DC3545" Height="34" Padding="16,0"/>
      </Grid>
    </Border>
  </Grid>

</Window>
