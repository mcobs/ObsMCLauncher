<Page x:Class="ObsMCLauncher.Pages.VersionDownloadPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="900"
      KeepAlive="True"
      Background="{StaticResource BackgroundBrush}">

    <Grid>
        <!-- 版本列表内容 -->
        <Grid x:Name="VersionListGrid" Margin="30">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 标题区域 -->
            <StackPanel Grid.Row="0">
                <TextBlock Text="版本管理" 
                         FontSize="28" 
                         FontWeight="Bold"
                         Margin="0,0,0,10"/>
                <TextBlock Text="管理已安装的版本或下载新版本" 
                         FontSize="14" 
                         Foreground="{StaticResource TextSecondaryBrush}"
                         Margin="0,0,0,25"/>
            </StackPanel>

            <!-- Tab 控件 -->
        <TabControl Grid.Row="1" 
                    Style="{StaticResource MaterialDesignTabControl}"
                    materialDesign:ColorZoneAssist.Mode="PrimaryMid">
            
            <!-- 已安装版本 Tab -->
            <TabItem Header="已安装版本">
                <TabItem.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="CheckCircle" 
                                                   Width="18" 
                                                   Height="18"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                            <TextBlock Text="已安装版本" 
                                     VerticalAlignment="Center"
                                     FontSize="14"/>
                        </StackPanel>
                    </DataTemplate>
                </TabItem.HeaderTemplate>
                
                <Grid Margin="0,20,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 工具栏 -->
                    <Border Grid.Row="0"
                            Background="{StaticResource SurfaceBrush}"
                            CornerRadius="8"
                            Padding="15,10,15,10"
                            Margin="0,0,0,15">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0"
                                     VerticalAlignment="Center"
                                     FontSize="13"
                                     Foreground="{StaticResource TextSecondaryBrush}">
                                <Run Text="共 "/>
                                <Run x:Name="InstalledVersionCountText" Text="0" FontWeight="SemiBold"/>
                                <Run Text=" 个已安装版本"/>
                            </TextBlock>
                            
                            <Button Grid.Column="1"
                                  x:Name="RefreshInstalledButton"
                                  Click="RefreshInstalledButton_Click"
                                  Style="{StaticResource MaterialDesignOutlinedButton}"
                                  Height="30"
                                  FontSize="12"
                                  Padding="12,0">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Refresh" 
                                                           Width="14" 
                                                           Height="14"
                                                           VerticalAlignment="Center"
                                                           Margin="0,0,6,0"/>
                                    <TextBlock Text="刷新" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- 已安装版本列表 -->
                    <Border Grid.Row="1"
                            Background="{StaticResource SurfaceBrush}"
                            CornerRadius="10">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel x:Name="InstalledVersionsPanel" Margin="10">
                                <!-- 动态生成已安装版本项 -->
                            </StackPanel>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </TabItem>

            <!-- 下载新版本 Tab -->
            <TabItem Header="下载新版本">
                <TabItem.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Download" 
                                                   Width="18" 
                                                   Height="18"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                            <TextBlock Text="下载新版本" 
                                     VerticalAlignment="Center"
                                     FontSize="14"/>
                        </StackPanel>
                    </DataTemplate>
                </TabItem.HeaderTemplate>
                
                <Grid Margin="0,20,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 筛选和搜索区域 -->
                    <Border Grid.Row="0"
                Background="{StaticResource SurfaceBrush}"
                CornerRadius="8"
                Padding="15,10,15,10"
                Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 搜索框 -->
                <TextBox Grid.Column="0"
                       x:Name="SearchBox"
                       materialDesign:HintAssist.Hint="搜索版本号..."
                       Style="{StaticResource MaterialDesignOutlinedTextBox}"
                       FontSize="13"
                       Margin="0,0,12,0"
                       TextChanged="SearchBox_TextChanged">
                    <TextBox.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="8"/>
                        </Style>
                    </TextBox.Resources>
                </TextBox>

                <!-- 版本类型筛选 -->
                <ComboBox Grid.Column="1"
                        x:Name="VersionTypeComboBox"
                        Width="120"
                        materialDesign:HintAssist.Hint="版本类型"
                        Style="{StaticResource MaterialDesignOutlinedComboBox}"
                        FontSize="13"
                        Margin="0,0,10,0"
                        SelectionChanged="VersionTypeComboBox_SelectionChanged">
                    <ComboBoxItem Content="全部版本" IsSelected="True"/>
                    <ComboBoxItem Content="正式版"/>
                    <ComboBoxItem Content="快照版"/>
                    <ComboBoxItem Content="远古版"/>
                </ComboBox>

                <!-- 刷新按钮 -->
                <Button x:Name="RefreshButton"
                      Grid.Column="2"
                      Style="{StaticResource MaterialDesignIconButton}"
                      Width="32"
                      Height="32"
                      Padding="0"
                      ToolTip="刷新版本列表"
                      Click="RefreshButton_Click">
                    <materialDesign:PackIcon Kind="Refresh" Width="18" Height="18"/>
                </Button>
            </Grid>
        </Border>

                    <!-- 版本列表 -->
                    <Border Grid.Row="1"
                Background="{StaticResource SurfaceBrush}"
                CornerRadius="10">
            <Grid>
                <!-- 加载指示器 -->
                <StackPanel x:Name="LoadingPanel"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="Collapsed">
                    
                    <!-- 使用 Material Design 的 ProgressBar 作为加载动画 -->
                    <materialDesign:Card Width="300" 
                                        Padding="32"
                                        UniformCornerRadius="10">
                        <StackPanel>
                            <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                       Value="0"
                                       IsIndeterminate="True"
                                       Width="64"
                                       Height="64"
                                       HorizontalAlignment="Center"/>
                            
                            <TextBlock Text="加载版本列表中..."
                                     FontSize="16"
                                     Margin="0,20,0,0"
                                     HorizontalAlignment="Center"
                                     Foreground="{StaticResource TextBrush}"/>
                            
                            <TextBlock x:Name="LoadingDetailText"
                                     Text="正在从服务器获取数据..."
                                     FontSize="12"
                                     Margin="0,8,0,0"
                                     HorizontalAlignment="Center"
                                     Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                    </materialDesign:Card>
                                </StackPanel>

                <!-- 版本列表滚动区域 -->
                <ScrollViewer x:Name="VersionScrollViewer"
                            VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="VersionListPanel" Margin="0,10">
                        <!-- 动态生成版本项 -->
                </StackPanel>
            </ScrollViewer>
                    </Grid>
                    </Border>
                </Grid>
            </TabItem>
            </TabControl>
        </Grid>
        
        <!-- 版本详情内容（叠加显示） -->
        <Frame x:Name="DetailFrame" 
               NavigationUIVisibility="Hidden"
               Visibility="Collapsed"/>
    </Grid>
</Page>
