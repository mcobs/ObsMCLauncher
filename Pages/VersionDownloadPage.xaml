<Page x:Class="ObsMCLauncher.Pages.VersionDownloadPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="900"
      KeepAlive="True"
      Background="{DynamicResource BackgroundBrush}"
      UseLayoutRounding="True"
      TextOptions.TextFormattingMode="Display"
      TextOptions.TextRenderingMode="ClearType">

    <Grid>
        <!-- 版本列表内容 -->
        <Grid x:Name="VersionListGrid" Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 标题区域 -->
            <StackPanel Grid.Row="0">
                <TextBlock Text="版本管理" 
                         FontSize="28" 
                         FontWeight="Bold"
                         Margin="0,0,0,8"/>
                <TextBlock Text="管理已安装的版本或下载新版本" 
                         FontSize="14" 
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         Margin="0,0,0,16"/>
            </StackPanel>

            <!-- Tab 控件 -->
        <TabControl Grid.Row="1" 
                    Style="{StaticResource MaterialDesignTabControl}"
                    materialDesign:ColorZoneAssist.Mode="PrimaryMid">
            
            <!-- 已安装版本 Tab -->
            <TabItem Header="已安装版本">
                <TabItem.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="CheckCircle" 
                                                   Width="18" 
                                                   Height="18"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                            <TextBlock Text="已安装版本" 
                                     VerticalAlignment="Center"
                                     FontSize="14"/>
                        </StackPanel>
                    </DataTemplate>
                </TabItem.HeaderTemplate>
                
                <Grid Margin="0,20,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 工具栏 -->
                    <Border Grid.Row="0"
                            Background="{DynamicResource SurfaceBrush}"
                            CornerRadius="8"
                            Padding="15,10,15,10"
                            Margin="0,0,0,15">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0"
                                     VerticalAlignment="Center"
                                     FontSize="13"
                                     Foreground="{DynamicResource TextSecondaryBrush}">
                                <Run Text="共 "/>
                                <Run x:Name="InstalledVersionCountText" Text="0" FontWeight="SemiBold"/>
                                <Run Text=" 个已安装版本"/>
                            </TextBlock>
                            
                            <Button Grid.Column="1"
                                  x:Name="RefreshInstalledButton"
                                      Click="RefreshInstalledButton_Click"
                                      Style="{StaticResource MaterialDesignOutlinedButton}"
                                      Height="30"
                                      FontSize="12"
                                      Padding="12,0">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Refresh" 
                                                               Width="14" 
                                                               Height="14"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,6,0"/>
                                        <TextBlock Text="刷新" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                        </Grid>
                    </Border>

                    <!-- 已安装版本列表 -->
                    <Border Grid.Row="1"
                            Background="{DynamicResource SurfaceBrush}"
                            CornerRadius="10">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel x:Name="InstalledVersionsPanel" Margin="10">
                                <!-- 动态生成已安装版本项 -->
                            </StackPanel>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </TabItem>

            <!-- 下载新版本 Tab -->
            <TabItem Header="下载新版本">
                <TabItem.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Download" 
                                                   Width="18" 
                                                   Height="18"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                            <TextBlock Text="下载新版本" 
                                     VerticalAlignment="Center"
                                     FontSize="14"/>
                        </StackPanel>
                    </DataTemplate>
                </TabItem.HeaderTemplate>
                
                <Grid Margin="0,20,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 筛选和搜索区域 -->
                    <Border Grid.Row="0"
                Background="{DynamicResource SurfaceBrush}"
                CornerRadius="8"
                Padding="15,10,15,10"
                Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 搜索框 -->
                <TextBox Grid.Column="0"
                       x:Name="SearchBox"
                       materialDesign:HintAssist.Hint="搜索版本号..."
                       Style="{StaticResource MaterialDesignOutlinedTextBox}"
                       FontSize="13"
                       Margin="0,0,12,0"
                       TextChanged="SearchBox_TextChanged">
                    <TextBox.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="8"/>
                        </Style>
                    </TextBox.Resources>
                </TextBox>

                <!-- 版本类型筛选 -->
                <ComboBox Grid.Column="1"
                        x:Name="VersionTypeComboBox"
                        Width="120"
                        materialDesign:HintAssist.Hint="版本类型"
                        Style="{StaticResource MaterialDesignOutlinedComboBox}"
                        FontSize="13"
                        Margin="0,0,10,0"
                        SelectionChanged="VersionTypeComboBox_SelectionChanged">
                    <ComboBoxItem Content="全部版本"/>
                    <ComboBoxItem Content="正式版" IsSelected="True"/>
                    <ComboBoxItem Content="快照版"/>
                    <ComboBoxItem Content="远古版"/>
                </ComboBox>

                <!-- 刷新按钮 -->
                <Button x:Name="RefreshButton"
                      Grid.Column="2"
                      Style="{StaticResource MaterialDesignIconButton}"
                      Width="32"
                      Height="32"
                      Padding="0"
                      ToolTip="刷新版本列表"
                      Click="RefreshButton_Click">
                    <materialDesign:PackIcon Kind="Refresh" Width="18" Height="18"/>
                </Button>
            </Grid>
        </Border>

                    <!-- 版本列表 -->
                    <Border Grid.Row="1"
                Background="{DynamicResource SurfaceBrush}"
                CornerRadius="10">
            <Grid>
                <!-- 版本列表滚动区域 -->
                <ScrollViewer x:Name="VersionScrollViewer"
                            VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="0,10">
                        <!-- 版本列表 -->
                        <StackPanel x:Name="VersionListPanel">
                            <!-- 动态生成版本项 -->
                        </StackPanel>
                        
                        <!-- 骨架屏加载效果 -->
                        <StackPanel x:Name="SkeletonLoadingPanel"
                                   Visibility="Collapsed">
                        <!-- 显示3个骨架屏版本卡片（宽度与实际卡片一致：Margin="20,0,20,12"） -->
                        <Border Style="{StaticResource SkeletonCardStyle}" Margin="20,0,20,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- 图标占位 -->
                                <Ellipse Grid.Column="0" 
                                        Width="28" Height="28" 
                                        Style="{StaticResource SkeletonCircleStyle}"
                                        Margin="0,0,12,0"/>
                                
                                <!-- 文本占位 -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <Rectangle Width="200" Height="16" 
                                               Style="{StaticResource SkeletonRectangleStyle}"
                                               Margin="0,0,0,8"/>
                                    <Rectangle Width="150" Height="14" 
                                               Style="{StaticResource SkeletonRectangleStyle}"/>
                                </StackPanel>
                                
                                <!-- 按钮占位 -->
                                <Rectangle Grid.Column="2" 
                                          Width="80" Height="28" 
                                          Style="{StaticResource SkeletonRectangleStyle}"
                                          RadiusX="4" RadiusY="4"/>
                            </Grid>
                        </Border>
                        
                        <Border Style="{StaticResource SkeletonCardStyle}" Margin="20,0,20,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <Ellipse Grid.Column="0" 
                                        Width="28" Height="28" 
                                        Style="{StaticResource SkeletonCircleStyle}"
                                        Margin="0,0,12,0"/>
                                
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <Rectangle Width="200" Height="16" 
                                               Style="{StaticResource SkeletonRectangleStyle}"
                                               Margin="0,0,0,8"/>
                                    <Rectangle Width="150" Height="14" 
                                               Style="{StaticResource SkeletonRectangleStyle}"/>
                                </StackPanel>
                                
                                <Rectangle Grid.Column="2" 
                                          Width="80" Height="28" 
                                          Style="{StaticResource SkeletonRectangleStyle}"
                                          RadiusX="4" RadiusY="4"/>
                            </Grid>
                        </Border>
                        
                        <Border Style="{StaticResource SkeletonCardStyle}" Margin="20,0,20,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <Ellipse Grid.Column="0" 
                                        Width="28" Height="28" 
                                        Style="{StaticResource SkeletonCircleStyle}"
                                        Margin="0,0,12,0"/>
                                
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <Rectangle Width="200" Height="16" 
                                               Style="{StaticResource SkeletonRectangleStyle}"
                                               Margin="0,0,0,8"/>
                                    <Rectangle Width="150" Height="14" 
                                               Style="{StaticResource SkeletonRectangleStyle}"/>
                                </StackPanel>
                                
                                <Rectangle Grid.Column="2" 
                                          Width="80" Height="28" 
                                          Style="{StaticResource SkeletonRectangleStyle}"
                                          RadiusX="4" RadiusY="4"/>
                            </Grid>
                        </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
                    </Grid>
                    </Border>
                </Grid>
            </TabItem>
            </TabControl>
        </Grid>
        
        <!-- 版本详情内容（叠加显示） -->
        <Frame x:Name="DetailFrame" 
               NavigationUIVisibility="Hidden"
               Visibility="Collapsed"/>
    </Grid>
</Page>
