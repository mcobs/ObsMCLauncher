<Page x:Class="ObsMCLauncher.Pages.SettingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="900"
      Background="{StaticResource BackgroundBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 悬浮保存通知卡片 -->
        <Border x:Name="SaveNotification"
                Grid.Row="1"
                Width="320"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Margin="0,20,0,0"
                Background="{StaticResource SurfaceBrush}"
                CornerRadius="10"
                Opacity="0"
                Panel.ZIndex="1000">
            <Border.Effect>
                <DropShadowEffect Color="Black" 
                                BlurRadius="20" 
                                ShadowDepth="2" 
                                Opacity="0.3"/>
            </Border.Effect>
            
            <StackPanel Margin="20,15">
                <!-- 图标和文字 -->
                <Grid Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <Border Grid.Column="0"
                            Background="{StaticResource PrimaryBrush}"
                            CornerRadius="20"
                            Width="36"
                            Height="36"
                            Margin="0,0,12,0">
                        <materialDesign:PackIcon Kind="CheckCircle"
                                               Width="20"
                                               Height="20"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"/>
                    </Border>
                    
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock x:Name="SaveNotificationText"
                                 Text="设置已自动保存"
                                 FontSize="14"
                                 FontWeight="SemiBold"
                                 Margin="0,0,0,2"/>
                        <TextBlock Text="修改已生效"
                                 FontSize="11"
                                 Foreground="{StaticResource TextSecondaryBrush}"/>
                    </StackPanel>
                </Grid>
                
                <!-- 进度条 -->
                <ProgressBar x:Name="SaveProgressBar"
                             Height="3"
                             Minimum="0"
                             Maximum="100"
                             Value="0"
                             Foreground="{StaticResource PrimaryBrush}"
                             Background="#3F3F46"
                             BorderThickness="0"/>
            </StackPanel>
        </Border>

        <!-- 主要内容区域 -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
        <Grid Margin="30">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 标题区域 -->
            <StackPanel Grid.Row="0">
                <TextBlock Text="设置" 
                         FontSize="28" 
                         FontWeight="Bold"
                         Margin="0,0,0,10"/>
                    <TextBlock Text="配置启动器和游戏参数（修改后自动保存）" 
                         FontSize="14" 
                         Foreground="#AAAAAA"
                         Margin="0,0,0,25"/>
            </StackPanel>

            <!-- 设置内容 -->
            <StackPanel Grid.Row="1">
                
                <!-- 游戏设置 -->
                <Border Background="{StaticResource SurfaceBrush}"
                        CornerRadius="10"
                        Padding="25"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="游戏设置" 
                                 FontSize="20" 
                                 FontWeight="SemiBold"
                                 Margin="0,0,0,20"/>

                        <!-- 游戏目录 -->
                        <TextBlock Text="游戏目录" 
                                 FontSize="14" 
                                 Margin="0,0,0,8"/>
                        <ComboBox x:Name="GameDirectoryLocationComboBox"
                                Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                SelectionChanged="GameDirectoryLocation_Changed_AutoSave"
                                Margin="0,0,0,10">
                            <ComboBoxItem Content="%APPDATA%\.minecraft（默认）" Tag="AppData"/>
                            <ComboBoxItem Content="运行目录\.minecraft" Tag="RunningDirectory"/>
                            <ComboBoxItem Content="自定义" Tag="Custom"/>
                        </ComboBox>
                        <Grid x:Name="CustomGameDirectoryPanel" Margin="0,0,0,20" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="GameDirectoryTextBox"
                                   Grid.Column="0"
                                   materialDesign:HintAssist.Hint="自定义游戏目录"
                                   Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                   Foreground="#FFFFFF"
                                   CaretBrush="#FFFFFF"
                                   Margin="0,0,10,0"/>
                            <Button Grid.Column="1"
                                  Content="浏览"
                                  Style="{StaticResource MaterialDesignOutlinedButton}"
                                  Width="100"
                                  Click="BrowseGameDirectory_Click"/>
                        </Grid>
                        <TextBlock x:Name="GameDirectoryDisplayText"
                                 FontSize="12"
                                 Foreground="{StaticResource TextSecondaryBrush}"
                                 TextWrapping="Wrap"
                                 Margin="0,0,0,20"/>

                        <!-- 内存分配 -->
                        <TextBlock Text="最大内存分配 (最小内存固定为512MB)" 
                                 FontSize="14" 
                                 Margin="0,0,0,8"/>
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="100"/>
                            </Grid.ColumnDefinitions>
                            <Slider x:Name="MaxMemorySlider"
                                  Grid.Column="0"
                                  Minimum="1024"
                                  Maximum="65536"
                                  Value="4096"
                                  TickFrequency="1"
                                  IsSnapToTickEnabled="True"
                                  Style="{StaticResource MaterialDesignDiscreteSlider}"
                                  Margin="0,0,20,0"
                                  ValueChanged="MaxMemorySlider_ValueChanged"/>
                            <TextBox x:Name="MaxMemoryTextBox"
                                     Grid.Column="1"
                                   Text="4096"
                                   Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                   Foreground="#FFFFFF"
                                   CaretBrush="#FFFFFF"
                                     FontSize="14"
                                     VerticalAlignment="Center"
                                   TextAlignment="Right"
                                   materialDesign:HintAssist.Hint="MB"
                                   PreviewTextInput="MaxMemoryTextBox_PreviewTextInput"
                                   TextChanged="MaxMemoryTextBox_TextChanged"/>
                        </Grid>

                        <!-- Java 路径 -->
                        <TextBlock Text="Java 路径" 
                                 FontSize="14" 
                                 Margin="0,0,0,8"/>
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="JavaPathTextBox"
                                   Grid.Column="0"
                                   Text="C:\Program Files\Java\jdk-17\bin\javaw.exe"
                                   Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                   Foreground="#FFFFFF"
                                   CaretBrush="#FFFFFF"
                                   Margin="0,0,10,0"
                                   LostFocus="JavaPathTextBox_LostFocus"/>
                            <Button Grid.Column="1"
                                  Content="浏览"
                                  Style="{StaticResource MaterialDesignOutlinedButton}"
                                  Width="100"
                                  Margin="0,0,10,0"
                                  Click="BrowseJavaPath_Click"/>
                            <Button Grid.Column="2"
                                  Content="自动检测"
                                  Style="{StaticResource MaterialDesignOutlinedButton}"
                                  Width="100"
                                  Click="AutoDetectJava_Click"/>
                        </Grid>

                        <!-- JVM 参数 -->
                        <TextBlock Text="JVM 参数" 
                                 FontSize="14" 
                                 Margin="0,10,0,8"/>
                        <TextBox x:Name="JvmArgumentsTextBox"
                               Text="-XX:+UseG1GC -XX:+UnlockExperimentalVMOptions"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               Foreground="#FFFFFF"
                               CaretBrush="#FFFFFF"
                               AcceptsReturn="True"
                               TextWrapping="Wrap"
                               MinHeight="60"
                               VerticalScrollBarVisibility="Auto"
                               LostFocus="JvmArgumentsTextBox_LostFocus"/>
                    </StackPanel>
                </Border>

                <!-- 启动器设置 -->
                <Border Background="{StaticResource SurfaceBrush}"
                        CornerRadius="10"
                        Padding="25"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="启动器设置" 
                                 FontSize="20" 
                                 FontWeight="SemiBold"
                                 Margin="0,0,0,20"/>

                        <!-- 主题设置 -->
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="主题模式" 
                                         FontSize="14" 
                                         Margin="0,0,0,5"/>
                                <TextBlock Text="选择启动器的外观主题" 
                                         FontSize="12" 
                                         Foreground="#AAAAAA"/>
                            </StackPanel>
                            <ComboBox Grid.Column="1"
                                    Width="150"
                                    Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                    VerticalAlignment="Center">
                                <ComboBoxItem Content="深色模式" IsSelected="True"/>
                                <ComboBoxItem Content="浅色模式"/>
                                <ComboBoxItem Content="跟随系统"/>
                            </ComboBox>
                        </Grid>

                        <Separator Margin="0,10,0,15" Background="#3F3F46"/>

                        <!-- 语言设置 -->
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="语言" 
                                         FontSize="14" 
                                         Margin="0,0,0,5"/>
                                <TextBlock Text="设置启动器显示语言" 
                                         FontSize="12" 
                                         Foreground="#AAAAAA"/>
                            </StackPanel>
                            <ComboBox Grid.Column="1"
                                    Width="150"
                                    Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                    VerticalAlignment="Center">
                                <ComboBoxItem Content="简体中文" IsSelected="True"/>
                                <ComboBoxItem Content="繁體中文"/>
                                <ComboBoxItem Content="English"/>
                                <ComboBoxItem Content="日本語"/>
                            </ComboBox>
                        </Grid>

                        <Separator Margin="0,10,0,15" Background="#3F3F46"/>

                        <!-- 自动检查更新 -->
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="自动检查更新" 
                                         FontSize="14" 
                                         Margin="0,0,0,5"/>
                                <TextBlock Text="启动时检查启动器更新" 
                                         FontSize="12" 
                                         Foreground="#AAAAAA"/>
                            </StackPanel>
                            <ToggleButton x:Name="AutoCheckUpdateToggle"
                                        Grid.Column="1"
                                        IsChecked="True"
                                        Style="{StaticResource MaterialDesignSwitchToggleButton}"
                                        VerticalAlignment="Center"/>
                        </Grid>

                        <Separator Margin="0,10,0,15" Background="#3F3F46"/>

                        <!-- 启动后关闭启动器 -->
                        <Grid Margin="0,0,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="游戏启动后关闭启动器" 
                                         FontSize="14" 
                                         Margin="0,0,0,5"/>
                                <TextBlock Text="减少内存占用" 
                                         FontSize="12" 
                                         Foreground="#AAAAAA"/>
                            </StackPanel>
                            <ToggleButton x:Name="CloseAfterLaunchToggle"
                                        Grid.Column="1"
                                        IsChecked="False"
                                        Style="{StaticResource MaterialDesignSwitchToggleButton}"
                                        VerticalAlignment="Center"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- 文件存储设置 -->
                <Border Background="{StaticResource SurfaceBrush}"
                        CornerRadius="10"
                        Padding="25"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="文件存储" 
                                 FontSize="20" 
                                 FontWeight="SemiBold"
                                 Margin="0,0,0,20"/>

                        <!-- 配置文件位置 -->
                        <TextBlock Text="配置文件存储位置" 
                                 FontSize="14" 
                                 Margin="0,0,0,8"/>
                        <ComboBox x:Name="ConfigFileLocationComboBox"
                                Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                SelectionChanged="ConfigFileLocation_Changed_AutoSave"
                                Margin="0,0,0,10">
                            <ComboBoxItem Content="%APPDATA%\ObsMCLauncher\config.json（默认）" Tag="AppData"/>
                            <ComboBoxItem Content="运行目录\config.json" Tag="RunningDirectory"/>
                            <ComboBoxItem Content="自定义" Tag="Custom"/>
                        </ComboBox>
                        <Grid x:Name="CustomConfigFilePanel" Margin="0,0,0,20" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="ConfigFileTextBox"
                                   Grid.Column="0"
                                   materialDesign:HintAssist.Hint="自定义配置文件路径"
                                   Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                   Margin="0,0,10,0"/>
                            <Button Grid.Column="1"
                                  Content="浏览"
                                  Style="{StaticResource MaterialDesignOutlinedButton}"
                                  Width="100"
                                  Click="BrowseConfigFile_Click"/>
                        </Grid>
                        <TextBlock x:Name="ConfigFileDisplayText"
                                 FontSize="12"
                                 Foreground="{StaticResource TextSecondaryBrush}"
                                 TextWrapping="Wrap"
                                 Margin="0,0,0,20"/>

                        <!-- 账号文件位置 -->
                        <TextBlock Text="账号文件存储位置" 
                                 FontSize="14" 
                                 Margin="0,0,0,8"/>
                        <ComboBox x:Name="AccountFileLocationComboBox"
                                Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                SelectionChanged="AccountFileLocation_Changed_AutoSave"
                                Margin="0,0,0,10">
                            <ComboBoxItem Content="%APPDATA%\ObsMCLauncher\accounts.json（默认）" Tag="AppData"/>
                            <ComboBoxItem Content="运行目录\accounts.json" Tag="RunningDirectory"/>
                        </ComboBox>
                        <TextBlock x:Name="AccountFileDisplayText"
                                 FontSize="12"
                                 Foreground="{StaticResource TextSecondaryBrush}"
                                 TextWrapping="Wrap"
                                 Margin="0,0,0,0"/>
                    </StackPanel>
                </Border>

                <!-- 账户设置 -->
                <Border Background="{StaticResource SurfaceBrush}"
                        CornerRadius="10"
                        Padding="25"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="账户管理" 
                                 FontSize="20" 
                                 FontWeight="SemiBold"
                                 Margin="0,0,0,20"/>

                        <!-- 当前账户 -->
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0"
                                    Width="50"
                                    Height="50"
                                    CornerRadius="25"
                                    Background="{StaticResource PrimaryBrush}"
                                    Margin="0,0,15,0">
                                <materialDesign:PackIcon Kind="Account"
                                                       Width="30"
                                                       Height="30"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"/>
                            </Border>

                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="Steve" 
                                         FontSize="16" 
                                         FontWeight="SemiBold"/>
                                <TextBlock Text="离线账户" 
                                         FontSize="12" 
                                         Foreground="#AAAAAA"
                                         Margin="0,3,0,0"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                <Button Content="切换账户"
                                      Style="{StaticResource MaterialDesignOutlinedButton}"
                                      Margin="0,0,10,0"/>
                                <Button Content="添加账户"
                                      Style="{StaticResource MaterialDesignRaisedButton}"
                                      Background="{StaticResource PrimaryBrush}"/>
                            </StackPanel>
                        </Grid>

                        <Separator Margin="0,10,0,15" Background="#3F3F46"/>

                        <!-- 账户类型说明 -->
                        <TextBlock Text="支持的账户类型" 
                                 FontSize="14" 
                                 Margin="0,0,0,10"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0"
                                    Background="#2D2D30"
                                    CornerRadius="8"
                                    Padding="15"
                                    Margin="0,0,10,0">
                                <StackPanel>
                                    <materialDesign:PackIcon Kind="Microsoft"
                                                           Width="30"
                                                           Height="30"
                                                           Margin="0,0,0,10"/>
                                    <TextBlock Text="微软账户" 
                                             FontSize="14" 
                                             FontWeight="SemiBold"
                                             Margin="0,0,0,5"/>
                                    <TextBlock Text="正版玩家推荐" 
                                             FontSize="11" 
                                             Foreground="#AAAAAA"/>
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="1"
                                    Background="#2D2D30"
                                    CornerRadius="8"
                                    Padding="15"
                                    Margin="10,0,0,0">
                                <StackPanel>
                                    <materialDesign:PackIcon Kind="AccountOff"
                                                           Width="30"
                                                           Height="30"
                                                           Margin="0,0,0,10"/>
                                    <TextBlock Text="离线模式" 
                                             FontSize="14" 
                                             FontWeight="SemiBold"
                                             Margin="0,0,0,5"/>
                                    <TextBlock Text="无需登录" 
                                             FontSize="11" 
                                             Foreground="#AAAAAA"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- 下载设置 -->
                <Border Background="{StaticResource SurfaceBrush}"
                        CornerRadius="10"
                        Padding="25"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="下载设置" 
                                 FontSize="20" 
                                 FontWeight="SemiBold"
                                 Margin="0,0,0,20"/>

                        <!-- 下载源 -->
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="下载源" 
                                         FontSize="14" 
                                         Margin="0,0,0,5"/>
                                <TextBlock x:Name="DownloadSourceDescription"
                                         Text="使用BMCLAPI镜像加速下载，适合中国大陆用户" 
                                         FontSize="12" 
                                         Foreground="#AAAAAA"/>
                            </StackPanel>
                            <ComboBox x:Name="DownloadSourceComboBox"
                                    Grid.Column="1"
                                    Width="250"
                                    Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                    VerticalAlignment="Center"
                                    SelectionChanged="DownloadSourceComboBox_SelectionChanged_AutoSave">
                                <ComboBoxItem Content="BMCLAPI (推荐-中国大陆)" IsSelected="True"/>
                                <ComboBoxItem Content="Mojang 官方源"/>
                            </ComboBox>
                        </Grid>

                        <Separator Margin="0,10,0,15" Background="#3F3F46"/>

                        <!-- 最大下载线程 -->
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="最大下载线程" 
                                         FontSize="14" 
                                         Margin="0,0,0,5"/>
                                <TextBlock Text="同时下载的文件数量" 
                                         FontSize="12" 
                                         Foreground="#AAAAAA"/>
                            </StackPanel>
                            <ComboBox x:Name="MaxDownloadThreadsComboBox"
                                    Grid.Column="1"
                                    Width="150"
                                    Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                    VerticalAlignment="Center"
                                    SelectionChanged="ComboBox_Changed">
                                <ComboBoxItem Content="4 线程"/>
                                <ComboBoxItem Content="8 线程" IsSelected="True"/>
                                <ComboBoxItem Content="16 线程"/>
                                <ComboBoxItem Content="32 线程"/>
                            </ComboBox>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- 底部按钮 -->
                <StackPanel Orientation="Horizontal" 
                          HorizontalAlignment="Right"
                          Margin="0,10,0,20">
                    <Button Content="测试下载源"
                          Style="{StaticResource MaterialDesignOutlinedButton}"
                          Margin="0,0,15,0"
                          Width="130"
                          Click="TestDownloadSource_Click"/>
                    <Button Content="恢复默认设置"
                          Style="{StaticResource MaterialDesignOutlinedButton}"
                          Width="150"
                          Click="ResetButton_Click"/>
                </StackPanel>

            </StackPanel>
        </Grid>
    </ScrollViewer>

    </Grid>
</Page>

